/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/BindingParser','sap/ui/base/ManagedObject','sap/ui/core/XMLTemplateProcessor','sap/ui/model/BindingMode','sap/ui/model/CompositeBinding','sap/ui/model/Context'],function(q,B,M,X,a,C,b){'use strict';var u={},N="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1",W=M.extend("sap.ui.core.util._with",{metadata:{properties:{any:"any"},aggregations:{child:{multiple:false,type:"sap.ui.core.util._with"}}}}),R=W.extend("sap.ui.core.util._repeat",{metadata:{aggregations:{list:{multiple:true,type:"n/a",_doesNotRequireFactory:true}}},updateList:function(){}});function g(w,S,i){function e(){var o=w.getBinding("any");return o instanceof C?o.getBindings()[i]:o;}return{getModel:function(){return e().getModel();},getPath:function(){var o=e();return o.getModel().resolve(o.getPath(),o.getContext());},getSetting:function(n){if(n==="bindingContexts"||n==="models"){throw new Error("Illegal argument: "+n);}return S[n];}};}function c(w,o,S){function p(I,i){var f=I.formatter;I.mode=a.OneTime;if(f&&f.requiresIContext===true){I.formatter=f.bind(null,g(w,S,i));}}try{p(o);if(o.parts){o.parts.forEach(p);}w.bindProperty("any",o);return w.getBinding("any")?w.getAny():u;}finally{w.unbindProperty("any",true);}}function d(e,L){return e.namespaceURI===N&&l(e)===L;}function l(n){return n.localName||n.baseName;}function s(e){var A,o=e.attributes,t="<"+e.nodeName,i,n;for(i=0,n=o.length;i<n;i+=1){A=o.item(i);t+=" "+A.name+'="'+A.value+'"';}return t+(e.childNodes.length?">":"/>");}return{process:function(r,v,S){var e,D=q.sap.log.isLoggable(q.sap.log.Level.DEBUG),f=0,h;function j(i){if(D){q.sap.log.debug((f<10?"[ ":"[")+f+"] "+Array.prototype.slice.call(arguments,1).join(" "),i&&s(i),"sap.ui.core.util.XMLPreprocessor");}}function k(i){if(D){q.sap.log.debug((f<10?"[ ":"[")+f+"] Finished","</"+i.nodeName+">","sap.ui.core.util.XMLPreprocessor");}}function m(i,n){throw new Error(e+": "+i+s(n));}function o(J){var K=J.childNodes,L,O=[],i,n,P=false;for(i=0,n=K.length;i<n;i+=1){L=K.item(i);if(L.nodeType===1){O.push(L);}}if(!O.length||!d(O[0],"then")){return null;}for(i=1,n=O.length;i<n;i+=1){L=O[i];if(P){m("Expected </"+J.prefix+":if>, but instead saw ",L);}if(d(L,"else")){P=true;}else if(!d(L,"elseif")){m("Expected <"+J.prefix+":elseif> or <"+J.prefix+":else>, but instead saw ",O[i]);}}return O;}function p(V,i,n,J,K){var L=B.complexParser(V,null,J,true)||V;if(L.functionsNotFound){if(J){I('Function name(s) '+L.functionsNotFound.join(", ")+' not found in ',i,null);}return u;}if(typeof L==="object"){L=c(n,L,S);if(L===u){I('Binding not ready in ',i,null);}}else if(K){K();}return L;}function t(P,i,T){var n;T=T||P;G(P,i);while((n=P.firstChild)){T.parentNode.insertBefore(n,T);}}function w(i,n){var J=I.bind(null,'Constant test condition in ',i,null),K,T=i.getAttribute("test"),L;try{L=p(T,i,n,true,J);if(L===u){L=false;}}catch(O){I('Error in formatter of ',i,O);L=false;}K=!!L&&L!=="false";if(D){if(typeof L==="string"){L=JSON.stringify(L);}else if(L===undefined){L="undefined";}else if(Array.isArray(L)){L="[object Array]";}j(i,"test ==",L,"-->",K);}return K;}function x(i,n,J){var V=n.value,K;try{K=p(V,i,J,false);if(K!==u){if(K===undefined){if(D){j(i,"removed attribute",n.name);}i.removeAttribute(n.name);}else{if(D&&K!==n.value){j(i,n.name,"=",K);}n.value=K;}}}catch(L){if(D){q.sap.log.debug(e+': Error in formatter of '+s(i),L,"sap.ui.core.util.XMLPreprocessor");}}}function y(i,n){var J=i.getAttribute("fragmentName"),K;function L(J){var P=X.loadTemplate(J,"fragment");n.$mFragmentContexts=n.$mFragmentContexts||{};if(n.$mFragmentContexts[J]){i.appendChild(i.ownerDocument.createTextNode("Error: Stopped due to cyclic fragment reference"));q.sap.log.error('Stopped due to cyclic reference in fragment: '+J,q.sap.serializeXML(i.ownerDocument.documentElement),"sap.ui.core.util.XMLPreprocessor");return;}f++;j(i,"fragmentName =",J);n.$mFragmentContexts[J]=true;if(l(P)==="FragmentDefinition"&&P.namespaceURI==="sap.ui.core"){t(P,n,i);}else{i.appendChild(P);t(i,n);}i.parentNode.removeChild(i);n.$mFragmentContexts[J]=false;k(i);f--;}try{K=p(J,i,n,true);if(K!==u){L(K);}}catch(O){I('Error in formatter of ',i,O);}}function z(i,n){var J=o(i),K,T;f++;if(J){T=i;K=J.shift();do{if(w(T,n)){break;}T=K=J.shift();}while(T&&l(T)==="elseif");}else if(w(i,n)){K=i;}if(K){t(K,n,i);}i.parentNode.removeChild(i);k(i);f--;}function A(n,J){var L=n.getAttribute("list")||"",K=B.complexParser(L),O,P,Q,T,V=n.getAttribute("var");if(V===""){m("Missing variable name for ",n);}if(!K){m("Missing binding for ",n);}T=new R();J.setChild(T);K.mode=a.OneTime;T.bindAggregation("list",K);P=T.getBinding("list");T.unbindAggregation("list",true);Q=K.model;if(!P){m("Missing model '"+Q+"' in ",n);}O=P.getContexts(K.startIndex,K.length);V=V||Q;T.setModel(P.getModel(),V);f++;j(n,"Starting");O.forEach(function(U,i){var Y=(i===O.length-1)?n:n.cloneNode(true);T.setBindingContext(U,V);j(n,V,"=",U.getPath());t(Y,T,n);});k(n);f--;n.parentNode.removeChild(n);}function E(i,n){var J,K,L,O,P=i.getAttribute("helper"),Q,T=i.getAttribute("path"),U,V=i.getAttribute("var");if(V===""){m("Missing variable name for ",i);}L=new W();n.setChild(L);J=B.simpleParser("{"+T+"}");V=V||J.model;if(P||V){K=n.getModel(J.model);if(!K){m("Missing model '"+J.model+"' in ",i);}U=K.resolve(J.path,n.getBindingContext(J.model));if(!U){m("Cannot resolve path for ",i);}if(P){O=q.sap.getObject(P);if(typeof O!=="function"){m("Cannot resolve helper for ",i);}Q=O(K.createBindingContext(U));if(Q instanceof b){K=Q.getModel();U=Q.getPath();}else if(Q!==undefined){if(typeof Q!=="string"||Q===""){m("Illegal helper result '"+Q+"' in ",i);}U=Q;}}L.setModel(K,V);L.bindObject({model:V,path:U});}else{L.bindObject(T);}f++;j(i,V,"=",U);if(L.getBindingContext(V)===n.getBindingContext(V)){I("Set unchanged path '"+U+"' in ",i,null);L=n;}t(i,L);i.parentNode.removeChild(i);k(i);f--;}function F(n,J){var i,K=n.attributes;if(K){for(i=K.length-1;i>=0;i-=1){x(n,K.item(i),J);}}}function G(J,K){var i,L=J.childNodes,n=L.length,O=new Array(n);for(i=0;i<n;i+=1){O[i]=L.item(i);}for(i=0;i<n;i+=1){H(O[i],K);}}function H(n,i){if(n.namespaceURI===N){switch(l(n)){case"if":z(n,i);return;case"repeat":A(n,i);return;case"with":E(n,i);return;default:m("Unexpected tag ",n);}}else if(n.namespaceURI==="sap.ui.core"&&l(n)==="Fragment"&&n.getAttribute("type")==="XML"){y(n,i);return;}F(n,i);G(n,i);}function I(T,i,n){if(q.sap.log.isLoggable(q.sap.log.Level.WARNING)){q.sap.log.warning(e+": "+T+s(i),n,"sap.ui.core.util.XMLPreprocessor");}}if(typeof S==="string"){e=S;S=v;}else{e=v.caller;}S=S||{};if(D){j(undefined,"Start processing",e);if(S.bindingContexts instanceof b){j(undefined,"undefined =",S.bindingContexts);}else{for(h in S.bindingContexts){j(undefined,h,"=",S.bindingContexts[h]);}}}H(r,new W({models:S.models,bindingContexts:S.bindingContexts}));j(undefined,"Finished processing",e);return r;}};},true);
