sap.ui.require(
	[
		"js/stockQuotesAPI",
		"sap/ui/thirdparty/sinon",
		"sap/ui/thirdparty/sinon-qunit"
	],
	function (stockQuotesAPI) {
		"use strict";
		
		QUnit.module("stockQuotesAPI", {
			setup: function () {
				this._oQueryResSingle = {"query":{"count":1,"created":"2016-01-29T15:06:26Z","lang":"en-us","results":{"quote":{"symbol":"FB2A.F","Ask":"102.368","AverageDailyVolume":"7203","Bid":"102.174","AskRealtime":null,"BidRealtime":null,"BookValue":"0.000","Change_PercentChange":"+3.058 - +3.080%","Change":"+3.058","Commission":null,"Currency":"EUR","ChangeRealtime":null,"AfterHoursChangeRealtime":null,"DividendShare":null,"LastTradeDate":"1/29/2016","TradeDate":null,"EarningsShare":null,"ErrorIndicationreturnedforsymbolchangedinvalid":null,"EPSEstimateCurrentYear":null,"EPSEstimateNextYear":null,"EPSEstimateNextQuarter":"0.000","DaysLow":"99.021","DaysHigh":"102.492","YearLow":"64.624","YearHigh":"102.492","HoldingsGainPercent":null,"AnnualizedGain":null,"HoldingsGain":null,"HoldingsGainPercentRealtime":null,"HoldingsGainRealtime":null,"MoreInfo":null,"OrderBookRealtime":null,"MarketCapitalization":null,"MarketCapRealtime":null,"EBITDA":"0.00","ChangeFromYearLow":"37.730","PercentChangeFromYearLow":"+58.384%","LastTradeRealtimeWithTime":null,"ChangePercentRealtime":null,"ChangeFromYearHigh":"-0.138","PercebtChangeFromYearHigh":"-0.135%","LastTradeWithTime":"4:01pm - <b>102.354</b>","LastTradePriceOnly":"102.354","HighLimit":null,"LowLimit":null,"DaysRange":"99.021 - 102.492","DaysRangeRealtime":null,"FiftydayMovingAverage":"93.187","TwoHundreddayMovingAverage":"89.003","ChangeFromTwoHundreddayMovingAverage":"13.351","PercentChangeFromTwoHundreddayMovingAverage":"+15.001%","ChangeFromFiftydayMovingAverage":"9.167","PercentChangeFromFiftydayMovingAverage":"+9.837%","Name":"FACEBOOK-A","Notes":null,"Open":"99.021","PreviousClose":"99.296","PricePaid":null,"ChangeinPercent":"+3.080%","PriceSales":null,"PriceBook":null,"ExDividendDate":null,"PERatio":null,"DividendPayDate":null,"PERatioRealtime":null,"PEGRatio":"0.000","PriceEPSEstimateCurrentYear":null,"PriceEPSEstimateNextYear":null,"Symbol":"FB2A.F","SharesOwned":null,"ShortRatio":"0.000","LastTradeTime":"4:01pm","TickerTrend":null,"OneyrTargetPrice":null,"Volume":"9894","HoldingsValue":null,"HoldingsValueRealtime":null,"YearRange":"64.624 - 102.492","DaysValueChange":null,"DaysValueChangeRealtime":null,"StockExchange":"FRA","DividendYield":null,"PercentChange":"+3.080%"}}}};
				this._oQueryResMulti = {"query":{"count":4,"created":"2016-01-29T15:04:29Z","lang":"en-US","results":{"quote":[{"symbol":"SAP","Ask":"78.29","AverageDailyVolume":"1123770","Bid":"78.27","AskRealtime":null,"BidRealtime":null,"BookValue":"21.10","Change_PercentChange":"+0.61 - +0.79%","Change":"+0.61","Commission":null,"Currency":"USD","ChangeRealtime":null,"AfterHoursChangeRealtime":null,"DividendShare":"1.22","LastTradeDate":"1/29/2016","TradeDate":null,"EarningsShare":"2.78","ErrorIndicationreturnedforsymbolchangedinvalid":null,"EPSEstimateCurrentYear":"4.16","EPSEstimateNextYear":"4.40","EPSEstimateNextQuarter":"0.94","DaysLow":"78.15","DaysHigh":"78.37","YearLow":"62.57","YearHigh":"81.21","HoldingsGainPercent":null,"AnnualizedGain":null,"HoldingsGain":null,"HoldingsGainPercentRealtime":null,"HoldingsGainRealtime":null,"MoreInfo":null,"OrderBookRealtime":null,"MarketCapitalization":"93.82B","MarketCapRealtime":null,"EBITDA":"6.69B","ChangeFromYearLow":"15.74","PercentChangeFromYearLow":"+25.16%","LastTradeRealtimeWithTime":null,"ChangePercentRealtime":null,"ChangeFromYearHigh":"-2.90","PercebtChangeFromYearHigh":"-3.57%","LastTradeWithTime":"9:48am - <b>78.31</b>","LastTradePriceOnly":"78.31","HighLimit":null,"LowLimit":null,"DaysRange":"78.15 - 78.37","DaysRangeRealtime":null,"FiftydayMovingAverage":"78.49","TwoHundreddayMovingAverage":"73.76","ChangeFromTwoHundreddayMovingAverage":"4.55","PercentChangeFromTwoHundreddayMovingAverage":"+6.16%","ChangeFromFiftydayMovingAverage":"-0.18","PercentChangeFromFiftydayMovingAverage":"-0.23%","Name":"SAP  SE ADS","Notes":null,"Open":"78.22","PreviousClose":"77.70","PricePaid":null,"ChangeinPercent":"+0.79%","PriceSales":"4.12","PriceBook":"3.68","ExDividendDate":"5/18/2015","PERatio":"28.17","DividendPayDate":"5/29/2015","PERatioRealtime":null,"PEGRatio":"1.94","PriceEPSEstimateCurrentYear":"18.82","PriceEPSEstimateNextYear":"17.80","Symbol":"SAP","SharesOwned":null,"ShortRatio":"6.11","LastTradeTime":"9:48am","TickerTrend":null,"OneyrTargetPrice":"86.60","Volume":"278038","HoldingsValue":null,"HoldingsValueRealtime":null,"YearRange":"62.57 - 81.21","DaysValueChange":null,"DaysValueChangeRealtime":null,"StockExchange":"NYQ","DividendYield":"1.55","PercentChange":"+0.79%"},{"symbol":"MSFT","Ask":"54.31","AverageDailyVolume":"38260900","Bid":"54.30","AskRealtime":null,"BidRealtime":null,"BookValue":"9.70","Change_PercentChange":"+2.20 - +4.24%","Change":"+2.20","Commission":null,"Currency":"USD","ChangeRealtime":null,"AfterHoursChangeRealtime":null,"DividendShare":"1.44","LastTradeDate":"1/29/2016","TradeDate":null,"EarningsShare":"1.50","ErrorIndicationreturnedforsymbolchangedinvalid":null,"EPSEstimateCurrentYear":"2.76","EPSEstimateNextYear":"3.11","EPSEstimateNextQuarter":"0.70","DaysLow":"54.00","DaysHigh":"54.79","YearLow":"39.72","YearHigh":"56.85","HoldingsGainPercent":null,"AnnualizedGain":null,"HoldingsGain":null,"HoldingsGainPercentRealtime":null,"HoldingsGainRealtime":null,"MoreInfo":null,"OrderBookRealtime":null,"MarketCapitalization":"433.42B","MarketCapRealtime":null,"EBITDA":"32.44B","ChangeFromYearLow":"14.54","PercentChangeFromYearLow":"+36.61%","LastTradeRealtimeWithTime":null,"ChangePercentRealtime":null,"ChangeFromYearHigh":"-2.59","PercebtChangeFromYearHigh":"-4.56%","LastTradeWithTime":"9:48am - <b>54.26</b>","LastTradePriceOnly":"54.26","HighLimit":null,"LowLimit":null,"DaysRange":"54.00 - 54.79","DaysRangeRealtime":null,"FiftydayMovingAverage":"53.70","TwoHundreddayMovingAverage":"49.43","ChangeFromTwoHundreddayMovingAverage":"4.83","PercentChangeFromTwoHundreddayMovingAverage":"+9.76%","ChangeFromFiftydayMovingAverage":"0.56","PercentChangeFromFiftydayMovingAverage":"+1.04%","Name":"Microsoft Corporation","Notes":null,"Open":"54.62","PreviousClose":"52.06","PricePaid":null,"ChangeinPercent":"+4.24%","PriceSales":"4.58","PriceBook":"5.37","ExDividendDate":"11/17/2015","PERatio":"36.08","DividendPayDate":"3/10/2016","PERatioRealtime":null,"PEGRatio":"2.07","PriceEPSEstimateCurrentYear":"19.73","PriceEPSEstimateNextYear":"17.45","Symbol":"MSFT","SharesOwned":null,"ShortRatio":"1.08","LastTradeTime":"9:48am","TickerTrend":null,"OneyrTargetPrice":"57.94","Volume":"12770512","HoldingsValue":null,"HoldingsValueRealtime":null,"YearRange":"39.72 - 56.85","DaysValueChange":null,"DaysValueChangeRealtime":null,"StockExchange":"NMS","DividendYield":"2.76","PercentChange":"+4.24%"},{"symbol":"FB2A.F","Ask":"102.159","AverageDailyVolume":"7203","Bid":"101.818","AskRealtime":null,"BidRealtime":null,"BookValue":"0.000","Change_PercentChange":"+3.196 - +3.219%","Change":"+3.196","Commission":null,"Currency":"EUR","ChangeRealtime":null,"AfterHoursChangeRealtime":null,"DividendShare":null,"LastTradeDate":"1/29/2016","TradeDate":null,"EarningsShare":null,"ErrorIndicationreturnedforsymbolchangedinvalid":null,"EPSEstimateCurrentYear":null,"EPSEstimateNextYear":null,"EPSEstimateNextQuarter":"0.000","DaysLow":"99.021","DaysHigh":"102.492","YearLow":"64.624","YearHigh":"102.492","HoldingsGainPercent":null,"AnnualizedGain":null,"HoldingsGain":null,"HoldingsGainPercentRealtime":null,"HoldingsGainRealtime":null,"MoreInfo":null,"OrderBookRealtime":null,"MarketCapitalization":null,"MarketCapRealtime":null,"EBITDA":"0.00","ChangeFromYearLow":"37.868","PercentChangeFromYearLow":"+58.597%","LastTradeRealtimeWithTime":null,"ChangePercentRealtime":null,"ChangeFromYearHigh":"0.000","PercebtChangeFromYearHigh":"+0.000%","LastTradeWithTime":"3:44pm - <b>102.492</b>","LastTradePriceOnly":"102.492","HighLimit":null,"LowLimit":null,"DaysRange":"99.021 - 102.492","DaysRangeRealtime":null,"FiftydayMovingAverage":"93.187","TwoHundreddayMovingAverage":"89.003","ChangeFromTwoHundreddayMovingAverage":"13.489","PercentChangeFromTwoHundreddayMovingAverage":"+15.156%","ChangeFromFiftydayMovingAverage":"9.305","PercentChangeFromFiftydayMovingAverage":"+9.985%","Name":"FACEBOOK-A","Notes":null,"Open":"99.021","PreviousClose":"99.296","PricePaid":null,"ChangeinPercent":"+3.219%","PriceSales":null,"PriceBook":null,"ExDividendDate":null,"PERatio":null,"DividendPayDate":null,"PERatioRealtime":null,"PEGRatio":"0.000","PriceEPSEstimateCurrentYear":null,"PriceEPSEstimateNextYear":null,"Symbol":"FB2A.F","SharesOwned":null,"ShortRatio":"0.000","LastTradeTime":"3:44pm","TickerTrend":null,"OneyrTargetPrice":null,"Volume":"9879","HoldingsValue":null,"HoldingsValueRealtime":null,"YearRange":"64.624 - 102.492","DaysValueChange":null,"DaysValueChangeRealtime":null,"StockExchange":"FRA","DividendYield":null,"PercentChange":"+3.219%"},{"symbol":"AAPL","Ask":"95.27","AverageDailyVolume":"48066800","Bid":"95.25","AskRealtime":null,"BidRealtime":null,"BookValue":"23.13","Change_PercentChange":"+1.18 - +1.25%","Change":"+1.18","Commission":null,"Currency":"USD","ChangeRealtime":null,"AfterHoursChangeRealtime":null,"DividendShare":"2.08","LastTradeDate":"1/29/2016","TradeDate":null,"EarningsShare":"9.40","ErrorIndicationreturnedforsymbolchangedinvalid":null,"EPSEstimateCurrentYear":"9.18","EPSEstimateNextYear":"10.06","EPSEstimateNextQuarter":"1.78","DaysLow":"94.35","DaysHigh":"95.50","YearLow":"92.00","YearHigh":"134.54","HoldingsGainPercent":null,"AnnualizedGain":null,"HoldingsGain":null,"HoldingsGainPercentRealtime":null,"HoldingsGainRealtime":null,"MoreInfo":null,"OrderBookRealtime":null,"MarketCapitalization":"528.22B","MarketCapRealtime":null,"EBITDA":"82.79B","ChangeFromYearLow":"3.27","PercentChangeFromYearLow":"+3.55%","LastTradeRealtimeWithTime":null,"ChangePercentRealtime":null,"ChangeFromYearHigh":"-39.27","PercebtChangeFromYearHigh":"-29.19%","LastTradeWithTime":"9:48am - <b>95.27</b>","LastTradePriceOnly":"95.27","HighLimit":null,"LowLimit":null,"DaysRange":"94.35 - 95.50","DaysRangeRealtime":null,"FiftydayMovingAverage":"103.36","TwoHundreddayMovingAverage":"113.13","ChangeFromTwoHundreddayMovingAverage":"-17.86","PercentChangeFromTwoHundreddayMovingAverage":"-15.79%","ChangeFromFiftydayMovingAverage":"-8.09","PercentChangeFromFiftydayMovingAverage":"-7.83%","Name":"Apple Inc.","Notes":null,"Open":"94.52","PreviousClose":"94.09","PricePaid":null,"ChangeinPercent":"+1.25%","PriceSales":"2.22","PriceBook":"4.07","ExDividendDate":"11/5/2015","PERatio":"10.14","DividendPayDate":"11/12/2015","PERatioRealtime":null,"PEGRatio":"0.89","PriceEPSEstimateCurrentYear":"10.41","PriceEPSEstimateNextYear":"9.47","Symbol":"AAPL","SharesOwned":null,"ShortRatio":"1.26","LastTradeTime":"9:48am","TickerTrend":null,"OneyrTargetPrice":"137.05","Volume":"5409803","HoldingsValue":null,"HoldingsValueRealtime":null,"YearRange":"92.00 - 134.54","DaysValueChange":null,"DaysValueChangeRealtime":null,"StockExchange":"NMS","DividendYield":"2.08","PercentChange":"+1.25%"}]}}};
			},
			teardown: function () {
				
			}
		});
		
		QUnit.test("Instantiation", function (assert) {
			var oStockQuotesAPI = new stockQuotesAPI();
			
			// Assert
			assert.ok(oStockQuotesAPI, "initialized");
		});
		
		
		QUnit.test("fetchdata data returned", function (assert) {
			const oFetchRes = {abc: "a"};
			
			sinon.stub(jQuery, "ajax").yieldsTo("success", oFetchRes);

			var oStockQuotesAPI = new stockQuotesAPI();

			oStockQuotesAPI.fetchData(["YHOO"], function(oQueryRes){
				assert.deepEqual(oQueryRes, oFetchRes, "correct data returned");
			});
			
			jQuery.ajax.restore();
		});
		
		
		QUnit.test("fetchData result to array", function (assert) {
			var oStockQuotesAPI = new stockQuotesAPI();
			
			var aQuotes = oStockQuotesAPI.queryResToArray(this._oQueryResSingle);
			assert.ok(aQuotes.length === 1, "single query res OK");
			
			aQuotes = oStockQuotesAPI.queryResToArray(this._oQueryResMulti);
			assert.ok(aQuotes.length === 4, "multi query res OK");
		});
	}
);