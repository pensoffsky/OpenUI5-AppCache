/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/Device'],function($,D){"use strict";var q=[],c={};function i(C,o,d){if(window["sap-ui-debug"]){o.timeout=300;}var s=new Date();f();function f(){var r=C();if(r.result){a(d);return;}var t=new Date()-s;t/=1000;var p=Math.round(t%60);if(o.timeout>p){setTimeout(f,o.pollingInterval);return;}if(o.error){try{o.error(o,r.arguments);}finally{d.reject(o,r.arguments);}return;}d.reject(o);}}function a(d){if(q.length===0){d.resolve();return true;}var f=q.shift();setTimeout(function(){i(f.callback,f.options,d);},0);}function e(p,n){var N=q.length-p;if(N){var d=q.splice(p,N);d.forEach(function(f){f.options._nestedIn=n;});q=d.concat(q);}}function b(d){d=(d||0)+2;if(D.browser.mozilla){d=d-1;}var E=new Error(),s=E.stack;if(!s){try{throw E();}catch(o){s=o.stack;}}if(!s){return"";}s=s.split("\n");s.splice(0,d);return s.join("\n");}var O=function(d){this.and=this;$.extend(this,d);};O.config={};O.extendConfig=function(o){O.config=jQuery.extend(O.config,o);};O.resetConfig=function(){O.config={arrangements:new O(),actions:new O(),assertions:new O(),timeout:15,pollingInterval:400,_stackDropCount:0};};O.getContext=function(){return c;};O.emptyQueue=function emptyQueue(){function d(f){var r="\nCallstack:\n";if(f._stack){r+=f._stack;delete f._stack;}else{r+="Unknown";}if(f._nestedIn){r+=d(f._nestedIn);delete f._nestedIn;}return r;}var o=$.Deferred();a(o);return o.promise().fail(function(f){f.errorMessage=f.errorMessage||"Failed to wait for check";f.errorMessage+=d(f);jQuery.sap.log.error(f.errorMessage);});};O.resetConfig();O.prototype={getContext:O.getContext,waitFor:function(o){var d=$.Deferred();o=$.extend({},O.config,o);o._stack=b(1+o._stackDropCount);delete o._stackDropCount;d.promise(this);q.push({callback:jQuery.proxy(function(){var r=true;if(o.check){r=o.check.apply(this,arguments);}if(r){if(o.success){try{var C=q.length;o.success.apply(this,arguments);}finally{e(C,o);d.resolve();}}else{d.resolve();}return{result:true,arguments:arguments};}return{result:false,arguments:arguments};},this),options:o});return this;},extendConfig:O.extendConfig,emptyQueue:O.emptyQueue};return O;},true);
